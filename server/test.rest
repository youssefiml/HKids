@baseUrl=http://localhost:5000
@adminEmail=admin@hkids.com
@adminPassword=admin123
@editorEmail=editor@hkids.com
@editorPassword=Editor1234

### Health Check
GET {{baseUrl}}/health
Accept: application/json

### Public Books (no auth, published only)
GET {{baseUrl}}/api/public/books
Accept: application/json

### Login as Admin
# @name adminLogin
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "{{adminEmail}}",
  "password": "{{adminPassword}}"
}

### Current User (me)
GET {{baseUrl}}/api/auth/me
Authorization: Bearer {{adminLogin.response.body.data.token}}
Accept: application/json

### Logout (JWT header POC)
POST {{baseUrl}}/api/auth/logout
Authorization: Bearer {{adminLogin.response.body.data.token}}
Accept: application/json

### Register Editor (POC)
# @name registerEditor
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "email": "{{editorEmail}}",
  "password": "{{editorPassword}}",
  "name": "Editor User",
  "role": "editor"
}

### Login as Editor
# @name editorLogin
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "{{editorEmail}}",
  "password": "{{editorPassword}}"
}

### Admin routes now contain Story management only under /api/admin/stories

###########################################################
# Admin Story Management (Admin-only)
###########################################################

### Create Story Draft (admin only)
# @name createStoryDraft
POST {{baseUrl}}/api/admin/stories
Authorization: Bearer {{adminLogin.response.body.data.token}}
Content-Type: application/json

{
  "title": "The Lighthouse and the Little Star",
  "description": "A calm story about courage and kindness.",
  "language": "en",
  "minAge": 5,
  "maxAge": 8,
  "coverImageUrl": "https://picsum.photos/seed/story-cover-1/600/900"
}

### Upload Story Image (admin only, raw binary body)
# @name uploadStoryImage
POST {{baseUrl}}/api/admin/stories/upload-image
Authorization: Bearer {{adminLogin.response.body.data.token}}
Content-Type: image/png

< ./sample-cover.png

### List Stories (admin only)
GET {{baseUrl}}/api/admin/stories?status=draft
Authorization: Bearer {{adminLogin.response.body.data.token}}
Accept: application/json

### Get Story Detail with Pages (admin only)
GET {{baseUrl}}/api/admin/stories/{{createStoryDraft.response.body.data._id}}
Authorization: Bearer {{adminLogin.response.body.data.token}}
Accept: application/json

### Update Story Metadata (admin only)
PATCH {{baseUrl}}/api/admin/stories/{{createStoryDraft.response.body.data._id}}
Authorization: Bearer {{adminLogin.response.body.data.token}}
Content-Type: application/json

{
  "description": "Updated draft description for the backoffice workflow."
}

### Add Story Page 1 (image only)
# @name createStoryPageOne
POST {{baseUrl}}/api/admin/stories/{{createStoryDraft.response.body.data._id}}/pages
Authorization: Bearer {{adminLogin.response.body.data.token}}
Content-Type: application/json

{
  "imageUrl": "https://picsum.photos/seed/story-page-1/960/1280"
}

### Add Story Page 2 (image + text)
# @name createStoryPageTwo
POST {{baseUrl}}/api/admin/stories/{{createStoryDraft.response.body.data._id}}/pages
Authorization: Bearer {{adminLogin.response.body.data.token}}
Content-Type: application/json

{
  "imageUrl": "https://picsum.photos/seed/story-page-2/960/1280",
  "text": "Nora watched the lighthouse blink over the sea."
}

### Add Story Page 3 (text only)
# @name createStoryPageThree
POST {{baseUrl}}/api/admin/stories/{{createStoryDraft.response.body.data._id}}/pages
Authorization: Bearer {{adminLogin.response.body.data.token}}
Content-Type: application/json

{
  "text": "The waves whispered, and Nora followed the light home."
}

### Edit Story Page (admin only)
PATCH {{baseUrl}}/api/admin/stories/{{createStoryDraft.response.body.data._id}}/pages/{{createStoryPageTwo.response.body.data._id}}
Authorization: Bearer {{adminLogin.response.body.data.token}}
Content-Type: application/json

{
  "text": "Nora watched the lighthouse glow and felt brave."
}

### Reorder Story Pages (admin only)
POST {{baseUrl}}/api/admin/stories/{{createStoryDraft.response.body.data._id}}/pages/reorder
Authorization: Bearer {{adminLogin.response.body.data.token}}
Content-Type: application/json

{
  "pageIds": [
    "{{createStoryPageTwo.response.body.data._id}}",
    "{{createStoryPageOne.response.body.data._id}}",
    "{{createStoryPageThree.response.body.data._id}}"
  ]
}

### Publish Story (admin only)
POST {{baseUrl}}/api/admin/stories/{{createStoryDraft.response.body.data._id}}/publish
Authorization: Bearer {{adminLogin.response.body.data.token}}
Content-Type: application/json

{
  "published": true
}

### Unpublish Story (admin only)
POST {{baseUrl}}/api/admin/stories/{{createStoryDraft.response.body.data._id}}/publish
Authorization: Bearer {{adminLogin.response.body.data.token}}
Content-Type: application/json

{
  "published": false
}

### Delete Story Page (admin only)
DELETE {{baseUrl}}/api/admin/stories/{{createStoryDraft.response.body.data._id}}/pages/{{createStoryPageOne.response.body.data._id}}
Authorization: Bearer {{adminLogin.response.body.data.token}}
Accept: application/json

### Delete Story (admin only)
DELETE {{baseUrl}}/api/admin/stories/{{createStoryDraft.response.body.data._id}}
Authorization: Bearer {{adminLogin.response.body.data.token}}
Accept: application/json

### Non-admin blocked from Story APIs (expect 403)
GET {{baseUrl}}/api/admin/stories
Authorization: Bearer {{editorLogin.response.body.data.token}}
Accept: application/json

### Missing token blocked from Story APIs (expect 401)
GET {{baseUrl}}/api/admin/stories
Accept: application/json

### Example Success Response (shape)
# {
#   "success": true,
#   "message": "Story created as draft",
#   "data": {
#     "id": "65f0a9...",
#     "_id": "65f0a9...",
#     "title": "The Lighthouse and the Little Star",
#     "status": "draft",
#     "pagesCount": 0
#   }
# }

### Example Error Response (shape)
# {
#   "success": false,
#   "message": "Admin access required"
# }

###########################################################
# Parent Authentication + Parental Control (New Feature)
###########################################################

@parentEmail=parent1@hkids.com
@parentPassword=Parent1234
@readerDeviceId=kid-tablet-001

### Parent Register
# @name parentRegister
POST {{baseUrl}}/api/parent/auth/register
Content-Type: application/json

{
  "email": "{{parentEmail}}",
  "password": "{{parentPassword}}"
}

### Parent Login
# @name parentLogin
POST {{baseUrl}}/api/parent/auth/login
Content-Type: application/json

{
  "email": "{{parentEmail}}",
  "password": "{{parentPassword}}"
}

### Parent Me
GET {{baseUrl}}/api/parent/auth/me
Authorization: Bearer {{parentLogin.response.body.data.token}}
Accept: application/json

### Create Child Profile
# @name createChild
POST {{baseUrl}}/api/parent/children
Authorization: Bearer {{parentLogin.response.body.data.token}}
Content-Type: application/json

{
  "name": "Lina",
  "age": 7,
  "dailyReadingLimitMinutes": 30
}

### List Child Profiles
GET {{baseUrl}}/api/parent/children
Authorization: Bearer {{parentLogin.response.body.data.token}}
Accept: application/json

### Create Pairing Code for Device
# @name createPairingCode
POST {{baseUrl}}/api/parent/devices/pairing-codes
Authorization: Bearer {{parentLogin.response.body.data.token}}
Content-Type: application/json

{
  "childProfileId": "{{createChild.response.body.data._id}}",
  "expiresInMinutes": 10
}

### Claim Pairing Code from Reader Device (public route)
# @name claimPairingCode
POST {{baseUrl}}/api/public/pairing/claim
Content-Type: application/json

{
  "code": "{{createPairingCode.response.body.data.code}}",
  "deviceId": "{{readerDeviceId}}",
  "deviceName": "Lina Tablet"
}

### Reader Context (public route with paired device)
GET {{baseUrl}}/api/public/reader/context
x-device-id: {{readerDeviceId}}
Accept: application/json

### Public Books (age restricted automatically by paired child profile)
GET {{baseUrl}}/api/public/books
x-device-id: {{readerDeviceId}}
Accept: application/json

### Public Book Read (consumes 1 minute and enforces daily limit)
# Replace {{bookId}} with a published book ID valid for child age
@bookId=000000000000000000000000
GET {{baseUrl}}/api/public/books/{{bookId}}
x-device-id: {{readerDeviceId}}
Accept: application/json

### Explicit Reader Usage Tracking (public, paired device required)
POST {{baseUrl}}/api/public/reader/usage
x-device-id: {{readerDeviceId}}
Content-Type: application/json

{
  "minutes": 5
}

### Parent Devices List
GET {{baseUrl}}/api/parent/devices
Authorization: Bearer {{parentLogin.response.body.data.token}}
Accept: application/json

### Parent Weekly Digest (all children)
GET {{baseUrl}}/api/parent/insights/weekly
Authorization: Bearer {{parentLogin.response.body.data.token}}
Accept: application/json

### Parent Weekly Digest (single child)
GET {{baseUrl}}/api/parent/insights/weekly?childProfileId={{createChild.response.body.data._id}}
Authorization: Bearer {{parentLogin.response.body.data.token}}
Accept: application/json

### Reassign Device to another Child Profile
# Requires another child profile first
PATCH {{baseUrl}}/api/parent/devices/{{readerDeviceId}}/child
Authorization: Bearer {{parentLogin.response.body.data.token}}
Content-Type: application/json

{
  "childProfileId": "{{createChild.response.body.data._id}}"
}
